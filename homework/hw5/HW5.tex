\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{makecell}
\usepackage{color}
\usepackage{amsmath}
\usepackage{wrapfig}
\usepackage{tikz}
\usepackage{setspace}
\usepackage{stmaryrd}
\usepackage{listings}
\usepackage{geometry}
\usepackage{array}
\usepackage{multirow}
\usepackage{minted}
\usetikzlibrary{arrows,shapes,chains,automata}

\geometry{top=4.5cm,bottom=3.2cm}
\title{Computer Architecture Homework 5}
\date{Spring 2023, April}
%\newcommand\boxempty{\makebox[1em][l]{$\boxempty$}}
\begin{document}

\maketitle
\setlength{\headsep}{-30pt}
\setlength{\footskip}{100pt}
%QQQQQQQQQQQ1
\section{True or False}
\noindent Please fill your answer (T or F) in the table below:{\color{red} (10 pts)}\par
\begin{table}[h!]
\centering
\renewcommand{\arraystretch}{1.6}
\setlength{\tabcolsep}{5mm}
\begin{tabular}{|c|c|c|c|}
\hline
1 & 2 & 3 & 4 \\ \hline
  &   &   &  \\ \hline
\end{tabular}
\end{table}
\begin{spacing}{1.2}
\noindent 1. Any cache miss that occurs when the cache is full is a capacity miss.\par
\noindent 2. Cache replacement policy is used for choosing which cache line should be evicted.\par
\noindent 3. For a 1-level, LRU cache, cache blocking will greatly speed up matrix transposition when the cache size is much larger than the matrix size.\par
\noindent 4. In a 32-bit machine (word size is 32 bit), the clock frequency is 2GHz. It takes 3 cycles to access L1, L1 cache has a hit rate of 30$\%$.It takes 40 cycles to access L2, L2 cache has a hit rate of 80$\%$. It takes 400 cycles to access physical memory. The average memory access time is 87{\color{red} ns}.\par
\end{spacing}
~\\
%QQQQQQQQQQQ2
\section{AMAT Analysis}
\noindent A program is running on a system with a single-level, write-back, 512B direct-mapped cache that has the block size of 4B. It traverses an array with step size = 1. Choose how the modification changes each component of AMAT. If there are multiple choices, select them all.{\color{red} (15 pts)}
\begin{table}[h!]
\renewcommand{\arraystretch}{1.5}
\centering
\setlength{\tabcolsep}{5mm}
\begin{tabular}{|c|c|c|c|}
\hline
Modification & Hit Time & Miss Rate & Miss Penalty \\ \hline
\multirow{3}{*}{\begin{tabular}{c} Change to 2-way Associativity\\ (cache size and block size keeps the same) \end{tabular}}
& A.Increase & A.Increase &A.Increase \\ 
& B.Decrease & B.Decrease &B.Decrease \\ 
& C.No effect & C.No effect & C.No effect \\ 
\hline
Your Choice & & & \\ \hline
\end{tabular}
\end{table}



\newpage
%QQQQQQQQQQQ3
\section{N-way Set Associative Cache}
\noindent A program is running on a byte-addressed system with a single-level cache, where memory addresses are 10 bits long. The entire cache is shown below. The block size of this cache is 16 B.\par
\begin{table}[h!]
\centering
\setlength{\tabcolsep}{5mm}
\begin{tabular}{|c|c|c|}
\hline
Index & Tag1 & Tag2  \\\hline
0b00 &  &  \\ \hline
0b01 &  &  \\ \hline
0b10 &  &  \\ \hline
0b11 &  &  \\ \hline
\end{tabular}
\end{table}
\noindent 1. Is this cache direct-mapped, set-associative, or fully-associative? If it is associative, also write down its associativity.{\color{red} (5 pts)}\par
~\\
~\\
\noindent 2. Write down the width (in bits) of Tag, Set index and Block offset.{\color{red} (5 pts)}\par
\begin{table}[h!]
\centering
\renewcommand{\arraystretch}{1.6}
\setlength{\tabcolsep}{5mm}
\begin{tabular}{|c|c|c|}
\hline
Tag & Set index & Block offset  \\\hline
  &   &   \\ \hline
\end{tabular}
\end{table}
\noindent 3. How many bytes of data can this cache contain? Please show your process.{\color{red} (5 pts)} \par
~\\
~\\
~\\
\noindent 4. We will access the data of addresses as follows, one by one. Fill in the blanks, and determine if each access would be a hit or miss based on the cache state shown above (suppose the cache is empty at first). This cache uses LRU replacement policy. If itâ€™s a miss, classify the possible miss type(s), select all possible miss types.{\color{red} (20 pts)}\par
\begin{table}[h!]
\centering
\renewcommand{\arraystretch}{1.3}
\setlength{\tabcolsep}{3mm}
\begin{tabular}{|c|c|c|}
\hline
Address &    & Your Choice\\\hline
0b0011010000 & A.Hit \hspace{3mm} B.Compulsory miss \hspace{3mm} C.Conflict miss & \\ \hline
0b0011011011 & A.Hit \hspace{3mm} B.Compulsory miss \hspace{3mm} C.Conflict miss & \\ \hline
0b1101000100 & A.Hit \hspace{3mm} B.Compulsory miss \hspace{3mm} C.Conflict miss & \\ \hline
0b0011001100 & A.Hit \hspace{3mm} B.Compulsory miss \hspace{3mm} C.Conflict miss & \\ \hline
0b0110100010 & A.Hit \hspace{3mm} B.Compulsory miss \hspace{3mm} C.Conflict miss & \\ \hline
0b0010111100 & A.Hit \hspace{3mm} B.Compulsory miss \hspace{3mm} C.Conflict miss & \\ \hline
0b1110100010 & A.Hit \hspace{3mm} B.Compulsory miss \hspace{3mm} C.Conflict miss & \\ \hline
0b1011000000 & A.Hit \hspace{3mm} B.Compulsory miss \hspace{3mm} C.Conflict miss & \\ \hline
0b1111111111 & A.Hit \hspace{3mm} B.Compulsory miss \hspace{3mm} C.Conflict miss & \\ \hline
0b0011001101 & A.Hit \hspace{3mm} B.Compulsory miss \hspace{3mm} C.Conflict miss & \\ \hline

%ugly...
% 0b0011011011 &  $\boxempty $Hit$ $ \hspace{3mm} $\boxempty $Compulsory miss$ $ \hspace{3mm} $\boxempty $Capacity miss$ $ \hspace{3mm} $\boxempty $Conflict miss$ $\\ \hline
% 0b0011001101 &  $\boxempty $Hit$ $ \hspace{3mm} $\boxempty $Compulsory miss$ $ \hspace{3mm} $\boxempty $Capacity miss$ $ \hspace{3mm} $\boxempty $Conflict miss$ $\\ \hline
% 0b0110100010 &  $\boxempty $Hit$ $ \hspace{3mm} $\boxempty $Compulsory miss$ $ \hspace{3mm} $\boxempty $Capacity miss$ $ \hspace{3mm} $\boxempty $Conflict miss$ $\\ \hline
% 0b0010111100 &  $\boxempty $Hit$ $ \hspace{3mm} $\boxempty $Compulsory miss$ $ \hspace{3mm} $\boxempty $Capacity miss$ $ \hspace{3mm} $\boxempty $Conflict miss$ $\\ \hline
% 0b1110100010 &  $\boxempty $Hit$ $ \hspace{3mm} $\boxempty $Compulsory miss$ $ \hspace{3mm} $\boxempty $Capacity miss$ $ \hspace{3mm} $\boxempty $Conflict miss$ $\\ \hline
% 0b1111111111 &  $\boxempty $Hit$ $ \hspace{3mm} $\boxempty $Compulsory miss$ $ \hspace{3mm} $\boxempty $Capacity miss$ $ \hspace{3mm} $\boxempty $Conflict miss$ $\\ \hline
% 0b0011001101 &  $\boxempty $Hit$ $ \hspace{3mm} $\boxempty $Compulsory miss$ $ \hspace{3mm} $\boxempty $Capacity miss$ $ \hspace{3mm} $\boxempty $Conflict miss$ $\\ \hline
\end{tabular}
\end{table}



\newpage
%QQQQQQQQQQQ4
\section{Cache Friendly Programming}
\noindent Assume a 32-bit machine, suppose the cache has the following settings:
\begin{table}[h!]
\centering
\setlength{\tabcolsep}{5mm}
\begin{tabular}{|c|c|}
\hline
Cache levels & 1 \\
Block size & 16 bytes \\ 
Number of sets & 4 \\
Cache size & 128 bytes  \\
Block replacement policy & LRU  \\ \hline
\end{tabular}
\end{table}

\noindent Suppose the following code is running on a system with the above cache. {\color{red} Answer the questions below and show your progress/explanation}.
\begin{minted}{c}
#define array_size    64    //line 1
#define repeat_times  1
#define step_size     2
int main(){
    int array[array_size] = {};
    for (int r = 0; r < repeat_times; r++){
        for (int i = 0; i < array_size; i += step_size){
            array[i] = array[i] + 2333;
        }
    }
    return 0;
}
  
  \end{minted}

\noindent 1. What is the total number of accesses to the cache?{\color{red} (5 pts)}
~\\
~\\
~\\
~\\
~\\
\noindent 2. What is the hit rate?{\color{red} (10 pts)}
~\\
~\\
~\\
~\\
~\\
~\\
\noindent 3. Which type(s) of miss occur(s){\color{red} (5 pts)}?

~\\
\newpage
\noindent 4. Suppose \lstinline{repeat_times} \textbf{goes to infinity} (only for this question), what number will the hit rate converge to?{\color{red} (5 pts)}
~\\
~\\
~\\
~\\
~\\
~\\
~\\
~\\
~\\
~\\
~\\
\noindent 5. If \lstinline{repeat_times} \textbf{is changed to 2} (only for this question), try to swap two lines of the above code to maximize the hit rate without disturbing the results. Which two lines will you choose and what is the maximized hit rate?{\color{red} (10 pts)}
~\\
~\\
~\\
~\\
~\\
~\\
~\\
~\\
~\\
~\\
~\\
~\\
~\\
\noindent 6. \textbf{For the modified code in the previous question}, suppose again \\ \lstinline{repeat_times} \textbf{goes to infinity} (only for this question), what number will the hit rate converge to?{\color{red} (5 pts)}




\end{document}
